---
## Author
author:
  name: Кхари Жекка Кализая Арсе
  degrees: DSc
  orcid: 0000-0002-0877-7063
  email: 1032234412@pfur.ru
  affiliation:
    - name: Российский университет дружбы народов
      country: Российская Федерация
      postal-code: 117198
      city: Москва
      address: ул. Миклухо-Маклая, д. 6

## Title
title: "Лабораторная работа № 14"
subtitle: "Настройка файловых служб Samba"
license: "CC BY"
---

# Цель работы

Приобретение навыков настройки доступа групп пользователей к общим ресурсам
по протоколу SMB.


# Задание

1. Установите и настройте сервер Samba (см. раздел 14.4.1).
2. Настройте на клиенте доступ к разделяемым ресурсам (см. раздел 14.4.2).
3. Напишите скрипты для Vagrant, фиксирующие действия по установке и настройке
сервера Samba для доступа к разделяемым ресурсам во внутреннем окружении
виртуальных машин server и client. Соответствующим образом необходимо внести
изменения в Vagrantfile (см. раздел 14.4.3).


# Выполнение лабораторной работы


##  Настройка сервера Samba

Сначала я установил утилиту samba samba-client и cifs-utils чтобы настроить его и делить каталог с клиентом

    dnf -y install samba samba-client cifs-utils

![установка](image/01.jpg){#fig-001 width=70%}


Потом я создал новую группу sambagroup 

    groupadd -g 1010 sambagroup

![создание группы](image/02.jpg){#fig-002 width=70%}


Дальше я добавил моего пользователя к группе sambagroup

    usermod -aG sambagroup qscalizaya

![добавление пользователя](image/03.jpg){#fig-003 width=70%}

Потом я создал каталог, который буду делить с клиентом

    mkdir -p /srv/sambashare

![создание каталога](image/04.jpg){#fig-004 width=70%}

Дальше я начал настроить утилиту samba, я открыл файл smb.conf и там я изменил строку workgroup  и потом добавил новый раздел, в котором я указал созданный каталог

    nano /etc/samba/smb.conf
    [global]
    workgroup = USER-NET  <---это я изменил
    . . .
    
    # то что я добавил
    [sambashare]
    comment = My Samba Share
    path = /srv/sambashare
    write list = @sambagroup

![настройка файла smb.conf](image/05.jpg){#fig-005 width=70%}

Потом я тестировал конфигурацию с командой testparm. он показал мою конфигурацию и также говорить он правилный или нет

    testparm

![name](image/06.jpg){#fig-006 width=70%}


Потом я запустил утилиту и смотрел его статус

    systemctl start smb
    systemctl enable smb
    systemctl status smb

![запуск утилиты](image/07.jpg){#fig-007 width=70%}

Дальше я попробовал подключаться с сервера. появился запрос пароля но я не написал ничего и только нажал enter

    sbmclient -L //server

![проверка работы samba](image/08.jpg){#fig-008 width=70%}

Также я смотрел файл конфигурации межсетевого экрана для samba

    less /usr/lib/firewalld/service/samba.xml

![конфигурация firewall](image/09.jpg){#fig-009 width=70%}

Потом я настроил firewall чтобы разрешал работы утилиты samba. я раньше выключил firewall из-за того появился ошибка но за запустил его еще раз и добавил сервис


    systemctl start firewalld.services
    firewall-cmd --add-service=samba
    firewall-cmd --add-service=samba --permanent
    firewall-cmd --reload

![настройка firwall](image/10.jpg){#fig-010 width=70%}

Потом я настроил права доступа для каталога sambashare

    chgrp sambagroup /srv/sambashare
    chmod g=rwx /srv/sambashare

![права доступа](image/11.jpg){#fig-011 width=70%}

Потом я посмотрел контекст безопасности SELinux 

    cd /srv
    ls -Z

![контекс каталога /srv](image/12.jpg){#fig-012 width=70%}


Дальше я настроил его и проверил его

    semanage fcontext -a -t samba_share_t "/srv/sambashare(/.*)?"
    restorecon -vR /srv/sambashare

    cd /srv
    ls -Z

![настройка контекста](image/13.jpg){#fig-013 width=70%}

![проверка настройки](image/14.jpg){#fig-014 width=70%}

Дальше я разрешил экспортировать разделяемые ресурсы для чтения и записи

    setsebool samba_export_all_rw 1
    setsebool samba_export_all_rw 1 -P

![экспортация ресурсов](image/15.jpg){#fig-015 width=70%}


Потом я смотрел UID моего пользователя 

    id

![id](image/16.jpg){#fig-016 width=70%}

и потом я создал файл в samba/share

    cd /srv/sambashare
    touch qscalizaya@server.txt

![создание файла](image/17.jpg){#fig-017 width=70%}


Потом я добавил моего пользователя qscalizaya в базу пользователей samba

    smbpasswd -L -a qscalizaya
    123456

![добавление пользователя в базу samba](image/18.jpg){#fig-018 width=70%}

## Монтирование файловой системы Samba на клиенте

Сначала я установил в клиенте samba-client cifs-utils

    dnf -y install samba-clinet cifs-utils

![установка](image/19.jpg){#fig-019 width=70%}


Дальше я посмотрел файл конфигурации межсетевого экрана для клиента samba

    less /usr/lib/firewalld/services/samba-client.xml

![настройка firewall](image/20.jpg){#fig-020 width=70%}

Потом я настроил firwall

    firewall-cmd --add-service=samba-client
    firewall-cmd --add-service=samba-client --permanent
    firewall-cmd --reload

![настройка firwall](image/21.jpg){#fig-021 width=70%}

Дальше я создал группу sambagroup и добавил моего пользователя к ей

    groupadd -g 1010 sambagroup
    usermod -aG sambagroup user

![создание группы и добавление пользователя](image/22.jpg){#fig-022 width=70%}

Потом я настроил конфигурационный файл smb.conf

    nano /etc/samba/smb.conf
    [global]
    workgroup = qscalizaya-NET

![настройный файл](image/23.jpg){#fig-023 width=70%}

Затем я проверил наличие общего доступа

    smbclient -L //server

![проверка](image/24.jpg){#fig-024 width=70%}

Также я подключиться под учётной записью

    smbclient -L //server -U qscalizaya

![проверка с поьзователем](image/25.jpg){#fig-025 width=70%}


Потом я создал каталог samba

    mkdir /mnt/samba

![создание каталога](image/26.jpg){#fig-026 width=70%}

и отмонтировал каталог

    mount -o username=qscalizaya,user,rw,uid=qscalizaya,gid=sambagroup //server/sambashare /mnt/samba

![монтирование каталога](image/27.jpg){#fig-027 width=70%}

Потом я создал файл там чтобы проверять работу

    cd /mnt/samba
    touch qscalizaya@client.txt

![создание файла](image/28.jpg){#fig-028 width=70%}

Дальше я отмонтировал его

    umount /mnt/samba

![отмонтировака](image/29.jpg){#fig-029 width=70%}


Потом я настроил каталог чтобы монтировался автоматически при запуске в систему

    touch /etc/samba/smbusers
    chmod 600 /etc/samba/smbusers

![создание файла](image/30.jpg){#fig-02 width=70%}


написал в файле данные

    nano /etc/samba/smbusers
    username=qscalizaya
    password=123456

![настройка файла](image/31.jpg){#fig-031 width=70%}


и настроил файл /fstab

    nano /etc/fstab
    //server/sambashare /mnt/samba cifs user,rw,uid=user_name,gid=sambagroup,credentials=/etc/samba/smbusers,_netdev 0 0

![файл /fstab](image/32.jpg){#fig-032 width=70%}

и монтировал его

    mount -a


![монтирование](image/33.jpg){#fig-033 width=70%}

Потом я перезагрузил систему чтобы проверять работу

    reboot
    cd /mnt/samba
    ls

![перезагрузка системы и проверка](image/34.jpg){#fig-034 width=70%}

## Контрольные вопросы

1. Какова минимальная конфигурация для smb.conf для создания общего ресурса,
который предоставляет доступ к каталогу /data?

    Минимальная конфигурация:

    [data]
      path = /data
      read only = no

2. Как настроить общий ресурс, который даёт доступ на запись всем пользователям,
имеющим права на запись в файловой системе Linux?

    Указать read only = no и права на самой FS:

    [share]
      path = /dir
      read only = no

3. Как ограничить доступ на запись к ресурсу только членам определённой группы?

    Указать группу и разрешить запись:

    write list = @groupname

4. Какой переключатель SELinux нужно использовать, чтобы позволить пользователям получать доступ к домашним каталогам на сервере через SMB?

    Разрешить доступ к домашним каталогам:

    setsebool -P samba_enable_home_dirs on

5. Как ограничить доступ к определённому ресурсу только узлам из сети
192.168.10.0/24?

    Ограничение по сети:

    hosts allow = 192.168.10.0/24

6. Какую команду можно использовать, чтобы отобразить список всех пользователей
Samba на сервере?

    Показать всех пользователей Samba:

    pdbedit -L

7. Что нужно сделать пользователю для доступа к ресурсу, который настроен как
многопользовательский ресурс?

Пользователь должен иметь Linux-учётку и Samba-пароль:

smbpasswd -a username

8. Как установить общий ресурс Samba в качестве многопользовательской учётной
записи, где пользователь alice используется как минимальная учётная запись
пользователя?

    Многопользовательский ресурс с минимальной учёткой:

    force user = alice

9. Как можно запретить пользователям просматривать учётные данные монтирования Samba в файле /etc/fstab?

    Использовать файл с учётными данными:

    credentials=/etc/samba/creds

10. Какая команда позволяет перечислить все экспортируемые ресурсы Samba, доступные на определённом сервере?

    Показать доступные ресурсы Samba на сервере:

    smbclient -L //server -N


# Выводы

в этой лабораторной работе я смог смотреть как можно настроить samba samba-client чтобы расделить каталог между клинетами с безопастностей

# Список литературы{.unnumbered}

::: {#refs}
:::
