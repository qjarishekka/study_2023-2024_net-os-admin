---
## Author
author:
  name: Кхари Жекка Кализая Арсе
  email: 1032234412
  affiliation:
    - name: Российский университет дружбы народов
      country: Российская Федерация
      postal-code: 117198
      city: Москва
      address: ул. Миклухо-Маклая, д. 6
## Title
title: презентация Лабораторная работа № 14
subtitle: Настройка файловых служб Samba
license: CC BY
date: today
date-format: "YYYY-MM-DD" # Example: 2025-09-06
---


# наш цель

## наш цель

:::::::::::::: {.columns align=center}
::: {.column width="100%"}

  * установить samba
  * настройть samba
  * разделить каталог с клиентом с помощью samba


:::

::::::::::::::

# Последовательность выполнения работы

# Настройка сервера Samba

## шаги

:::::::::::::: {.columns align=center}
::: {.column width="100%"}

  * установка утилиты
  * создание группы и добавление
  * создание каталога sambashare
  * настройка файла smb.conf
  * запуск утилиты
  * проверка


:::

::::::::::::::

## шаги

:::::::::::::: {.columns align=center}
::: {.column width="100%"}

  * межсетевой экран
  * права доступа
  * контекст безопастности
  * экспортация
  * база пользователей samba

:::

::::::::::::::



## установка

:::::::::::::: {.columns align=center}
::: {.column width="30%"}

  * dnf -y install samba samba-client cifs-utils

:::
::: {.column width="70%"}

![](./image/01.jpg)

:::
::::::::::::::

## создание группы sambagroup

:::::::::::::: {.columns align=center}
::: {.column width="30%"}

  * groupadd -g 1010 sambagroup
  * usermod -aG sambagroup user

:::
::: {.column width="70%"}

![](./image/03.jpg)

:::
::::::::::::::

## создание каталога sambashare

:::::::::::::: {.columns align=center}
::: {.column width="30%"}

  * mkdir -p /srv/sambashare

:::
::: {.column width="70%"}

![](./image/04.jpg)

:::
::::::::::::::

## создание каталога sambashare

:::::::::::::: {.columns align=center}
::: {.column width="30%"}

  * mkdir -p /srv/sambashare

:::
::: {.column width="70%"}

![](./image/04.jpg)

:::
::::::::::::::

## настройка файла /etc/samba/smb.conf

:::::::::::::: {.columns align=center}
::: {.column width="30%"}

  * nano /etc/samba/smb.conf

:::
::: {.column width="70%"}

![](./image/05.jpg)

:::
::::::::::::::

## проверка настройки

:::::::::::::: {.columns align=center}
::: {.column width="30%"}

  * testparm

:::
::: {.column width="70%"}

![](./image/06.jpg)

:::
::::::::::::::

## запуск утилиты

:::::::::::::: {.columns align=center}
::: {.column width="30%"}

  * systemctl start smb
  * systemctl enable smb
  * systemctl status smb

:::
::: {.column width="70%"}

![](./image/07.jpg)

:::
::::::::::::::


## проверка наличия доступа

:::::::::::::: {.columns align=center}
::: {.column width="30%"}

  * smbclient -L //server

:::
::: {.column width="70%"}

![](./image/08.jpg)

:::
::::::::::::::

## файл конфигурации firewall

:::::::::::::: {.columns align=center}
::: {.column width="30%"}

  * less /usr/lib/firewalld/services/samba.xml

:::
::: {.column width="70%"}

![](./image/09.jpg)

:::
::::::::::::::


## настройка firewall

:::::::::::::: {.columns align=center}
::: {.column width="30%"}

  * firewall-cmd --add-service=samba
  * firewall-cmd --add-service=samba --permanent
  * firewall-cmd --reload

:::
::: {.column width="70%"}

![](./image/10.jpg)

:::
::::::::::::::


## настройка права доступа

:::::::::::::: {.columns align=center}
::: {.column width="30%"}

  * chgrp sambagroup /srv/sambashare
  * chmod g=rwx /srv/sambashare


:::
::: {.column width="70%"}

![](./image/11.jpg)

:::
::::::::::::::

## контекст безопастности

:::::::::::::: {.columns align=center}
::: {.column width="30%"}

* semanage fcontext -a -t samba_share_t "/srv/sambashare(/.*)?"
* restorecon -vR /srv/sambashare

:::
::: {.column width="70%"}

![](./image/13.jpg)

:::
::::::::::::::


## проверка контекста

:::::::::::::: {.columns align=center}
::: {.column width="30%"}

* cd /srv
* ls -Z

:::
::: {.column width="70%"}

![](./image/14.jpg)

:::
::::::::::::::

## экпортация

:::::::::::::: {.columns align=center}
::: {.column width="30%"}

* setsebool samba_export_all_rw 1
* setsebool samba_export_all_rw 1 -P

:::
::: {.column width="70%"}

![](./image/15.jpg)

:::
::::::::::::::

## id

:::::::::::::: {.columns align=center}
::: {.column width="30%"}

* id

:::
::: {.column width="70%"}

![](./image/16.jpg)

:::
::::::::::::::


## создание файла

:::::::::::::: {.columns align=center}
::: {.column width="30%"}

* cd /srv/sambashare
* touch user@server.txt

:::
::: {.column width="70%"}

![](./image/17.jpg)

:::
::::::::::::::

## добавление пользователя в базу пользователей samba

:::::::::::::: {.columns align=center}
::: {.column width="30%"}

* smbpasswd -L -a qscalizaya

:::
::: {.column width="70%"}

![](./image/18.jpg)

:::
::::::::::::::



# Монтирование файловой системы Samba на клиенте


## шаги

:::::::::::::: {.columns align=center}
::: {.column width="100%"}

* установка
* конфигурация
* firewall
* создание группы
* настройка файла smb.conf
* проверка работы

:::

::::::::::::::

## шаги

:::::::::::::: {.columns align=center}
::: {.column width="100%"}


* проверка под учетной записей
* создание каталога для разделения
* монтировка каталога с сервера
* проверка с созданным файлом
* отмонтировка
* автоматизация монтирования
* проверка при перезагрузки

:::
::::::::::::::

## установка утилит samba-client cifs-utils

:::::::::::::: {.columns align=center}
::: {.column width="30%"}

* dnf -y install samba-client cifs-utils

:::
::: {.column width="70%"}

![](./image/19.jpg)

:::
::::::::::::::

## файл настроки firwall

:::::::::::::: {.columns align=center}
::: {.column width="30%"}

* less /usr/lib/firewalld/services/samba-client.xml

:::
::: {.column width="70%"}

![](./image/20.jpg)

:::
::::::::::::::

## файл настроки firwall

:::::::::::::: {.columns align=center}
::: {.column width="30%"}

* less /usr/lib/firewalld/services/samba-client.xml

:::
::: {.column width="70%"}

![](./image/20.jpg)

:::
::::::::::::::

## настройка firewall

:::::::::::::: {.columns align=center}
::: {.column width="30%"}

* firewall-cmd --add-service=samba-client
* firewall-cmd --add-service=samba-client --permanent
* firewall-cmd --reload

:::
::: {.column width="70%"}

![](./image/21.jpg)

:::
::::::::::::::


## создание группы sambagroup

:::::::::::::: {.columns align=center}
::: {.column width="30%"}

* groupadd -g 1010 sambagroup
* usermod -aG sambagroup user

:::
::: {.column width="70%"}

![](./image/22.jpg)

:::
::::::::::::::

## настройка файла smb.conf

:::::::::::::: {.columns align=center}
::: {.column width="30%"}

* nano /etc/samba/smb.conf
* workgroup = qscalizaya-NET

:::
::: {.column width="70%"}

![](./image/23.jpg)

:::
::::::::::::::

## проверка работы

:::::::::::::: {.columns align=center}
::: {.column width="30%"}

* smbclient -L //server -U
* smbclinet -L //server -u qscalizaya

:::
::: {.column width="70%"}

![](./image/25.jpg)

:::
::::::::::::::


## создание каталога для монтирования и монтирование

:::::::::::::: {.columns align=center}
::: {.column width="30%"}

* mkdir /mnt/samba
* mount -o username=qscalizaya,user,rw,uid=qscalizaya,gid=sambagroup //server/sambashare /mnt/samba

:::
::: {.column width="70%"}

![](./image/27.jpg)

:::
::::::::::::::

## проверка правильного создания

:::::::::::::: {.columns align=center}
::: {.column width="30%"}

* cd /mnt/samba
* touch qscalizaya@client.txt

:::
::: {.column width="70%"}

![](./image/28.jpg)

:::
::::::::::::::

## отмонтирование

:::::::::::::: {.columns align=center}
::: {.column width="30%"}

* umount /mnt/samba

:::
::: {.column width="70%"}

![](./image/29.jpg)

:::
::::::::::::::

## настройка автомонтирования

:::::::::::::: {.columns align=center}
::: {.column width="30%"}

* touch /etc/samba/smbusers
* chmod 600 /etc/samba/smbusers


:::
::: {.column width="70%"}

![](./image/31.jpg)

:::
::::::::::::::

## настройка в файле /etc/fstab

:::::::::::::: {.columns align=center}
::: {.column width="30%"}

* nano /etc/ftab
* //server/sambashare /mnt/samba cifs user,rw,uid=qscalizaya,gid=sambagroup,credentials=/etc/samba/smbusers,_netdev 0 0


:::
::: {.column width="70%"}

![](./image/32.jpg)

:::
::::::::::::::



## проверка

:::::::::::::: {.columns align=center}
::: {.column width="30%"}

* mount -a
* reboot

:::
::: {.column width="70%"}

![](./image/34.jpg)

:::
::::::::::::::


#  Внесение изменений в настройки внутреннего окружения виртуальных машин

## каталоги и файлы для скрипта

:::::::::::::: {.columns align=center}
::: {.column width="30%"}

* cd /vagrant/provision/server
* mkdir -p /vagrant/provision/server/smb/etc/samba
* cp -R /etc/samba/smb.conf /vagrant/provision/server/smb/etc/samba/
* cd /vagrant/provision/server
* touch smb.sh
* chmod +x smb.sh


:::
::: {.column width="70%"}

![](./image/35.jpg)

:::
::::::::::::::



## скрипт

:::::::::::::: {.columns align=center}

::: {.column width="100%"}

![](./image/36.jpg)

:::
::::::::::::::

## каталоги и файлы для скрипта в клиенте

:::::::::::::: {.columns align=center}
::: {.column width="30%"}

* cd /vagrant/provision/client
* mkdir -p /vagrant/provision/client/smb/etc/samba
* cp -R /etc/samba/smb.conf /vagrant/provision/client/smb/etc/samba/
* cp -R /etc/samba/smbusers /vagrant/provision/client/smb/etc/samba/
* cd /vagrant/provision/client
* touch smb.sh
* chmod +x smb.sh

:::
::: {.column width="70%"}

![](./image/37.jpg)

:::
::::::::::::::

## скрипт в клиенте

:::::::::::::: {.columns align=center}

::: {.column width="100%"}

![](./image/38.jpg)

:::
::::::::::::::

# спасибо за внимание