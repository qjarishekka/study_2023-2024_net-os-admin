---
## Author
author:
  name: Кхари Жекка Кализая арсе
  email: 1032234412@pfur.ru
  affiliation:
    - name: Российский университет дружбы народов
      country: Российская Федерация
      postal-code: 117198
      city: Москва
      address: ул. Миклухо-Маклая, д. 6

## Title
title: "Лабораторная работа № 15"
subtitle: "Настройка сетевого журналирования"
license: "CC BY"
---

# Цель работы

Получение навыков по работе с журналами системных событий.

# Задание

1. Настройте сервер сетевого журналирования событий.
2. Настройте клиент для передачи системных сообщений в сетевой журнал на сервере.
3. Просмотрите журналы системных событий с помощью нескольких программ. При наличии сообщений о некорректной работе сервисов исправьте
ошибки в настройках соответствующих служб.
4. Напишите скрипты для Vagrant, фиксирующие действия по установке и настройке
сетевого сервера журналирования.


# Выполнение лабораторной работы

## Настройка сервера сетевого журнала

Сначала я шел в каталог /etc/rsyslog.d чтобы создать там файл netlog-server.conf в котором я буду написать настройку для журнала

    cd /etc/rsyslog.d
    touch netlog-server.conf

![name](image/01.jpg){#fig-001 width=70%}


Потом я открыл его с помощью nano и там написал следующие строки

    $ModLoad imtcp
    $InputTCPServerRun 514

![name](image/02.jpg){#fig-002 width=70%}

Дальше я перезапустил службу rsyslog и также смотрел какие порты он использует

    systemctl restart rsyslog
    lsof | grep TCP

![name](image/03.jpg){#fig-003 width=70%}

![name](image/04.jpg){#fig-004 width=70%}

Потом я настроил межсетевой экран для приёма сообщений по TCP-порт 514

    firewall-cmd --add-port=514/tcp
    firewall-cmd --add-port=514/tcp --permanent

![name](image/05.jpg){#fig-005 width=70%}

## Настройка клиента сетевого журнала

В клиенте я создал файл конфигурации /etc/rsyslog.d/netlog-client.conf

    cd /etc/rsyslog.d
    touch netlog-client.conf

![name](image/06.jpg){#fig-006 width=70%}


Затем я открыл его с помощью nano и написал следующую строку

    *.* @@server.qscalizaya.net:514

![name](image/07.jpg){#fig-007 width=70%}

Потом я перезапустил службу rsyslog

    systemctl restart rsyslog

![name](image/08.jpg){#fig-008 width=70%}


## Просмотр журнала

на сервере я просмотрел один из файлов журнала в другом окне

    tail -f /var/log/messages

![name](image/09.jpg){#fig-009 width=70%}

Потом я нажал ctrl+d чтобы выходить из root и открыл графическую программу для просмотра журналов в background режиме

    gnome-system-monitor &

![name](image/11.jpg){#fig-011 width=70%}

Дальше я установил lnav 

    dnf -y install lnav

![name](image/12.jpg){#fig-012 width=70%}

и запустил его 

    lnav

![name](image/13.jpg){#fig-013 width=70%}

также я это сделал в клинете

![name](image/14.jpg){#fig-014 width=70%}


## Внесение изменений в настройки внутреннего окружения виртуальных машин

В сервере я создал необходимые каталоги и файлы

    cd /vagrant/provision/server
    mkdir -p /vagrant/provision/server/netlog/etc/rsyslog.d
    cp -R /etc/rsyslog.d/netlog-server.conf /vagrant/provision/server/netlog/etc/rsyslog.d
    cd /vagrant/provision/server
    touch netlog.sh
    chmod +x netlog.sh

![name](image/15.jpg){#fig-015 width=70%}

и там я добавил следующий скрипт

![name](image/16.jpg){#fig-016 width=70%}


Потом я повторил действие в клиенте

    cd /vagrant/provision/client
    mkdir -p /vagrant/provision/client/netlog/etc/rsyslog.d
    cp -R /etc/rsyslog.d/netlog-client.conf /vagrant/provision/client/netlog/etc/rsyslog.d/
    cd /vagrant/provision/client
    touch netlog.sh
    chmod +x netlog.sh

![name](image/17.jpg){#fig-017 width=70%}

и там я добавил следующий скрипт

![name](image/18.jpg){#fig-018 width=70%}

Потом в каталоге vagrant я открыл файл vagrantfile и там я добавил инструкции чтобы обрабативать созданные скрипты

![name](image/19.jpg){#fig-019 width=70%}

![name](image/20.jpg){#fig-020 width=70%}



## Контрольные вопросы

1. Какой модуль rsyslog вы должны использовать для приёма сообщений от journald?

imjournal (модуль для приёма сообщений из journald)

2. Как называется устаревший модуль, который можно использовать для включения
приёма сообщений журнала в rsyslog?

imuxsock (устаревший модуль приёма сообщений)

3. Чтобы убедиться, что устаревший метод приёма сообщений из journald в rsyslog
не используется, какой дополнительный параметр следует использовать?

Параметр IgnorePreviousMessagesOnStartup="on" (чтобы не использовать устаревший метод)

4. В каком конфигурационном файле содержатся настройки, которые позволяют вам
настраивать работу журнала?

/etc/rsyslog.conf (основной файл конфигурации журнала)

5. Каким параметром управляется пересылка сообщений из journald в rsyslog?

Параметр ForwardToSyslog (в файле journald)


6. Какой модуль rsyslog вы можете использовать для включения сообщений из файла
журнала, не созданного rsyslog?

imfile (для чтения логов из произвольных файлов)

7. Какой модуль rsyslog вам нужно использовать для пересылки сообщений в базу
данных MariaDB?

ommysql (модуль для записи логов в MariaDB)

8. Какие две строки вам нужно включить в rsyslog.conf, чтобы позволить текущему
журнальному серверу получать сообщения через TCP?

    $ModLoad imtcp
    $InputTCPServerRun 514

9. Как настроить локальный брандмауэр, чтобы разрешить приём сообщений журнала
через порт TCP 514?

    firewall-cmd --add-port=514/tcp
    firewall-cmd --add-port=514/tcp --permanent
    firewall-cmd --reload


# Выводы

сегодня я смог смотреть как можно смотреть журнал сервера с клинета и как настроить его с файла rsyslog.d/netlog-server.conf

# Список литературы{.unnumbered}

::: {#refs}
:::
